openapi: 3.0.3
info:
  title: Investment Service API
  description: |
    Handles investor fund allocations, settlements, and investment tracking within the Nexus ecosystem.
    Provides endpoints for creating, retrieving, and settling investments with clear data flow between investors and fund requests.
  version: 1.0.0
  contact:
    name: API Support
    email: support@nexus.com

servers:
  - url: http://localhost:3004/api/v1
    description: Local development server
  - url: https://api.nexus.io/investments/v1
    description: Production server

tags:
  - name: Investments
    description: Investment creation, tracking, and settlement operations
  - name: Health
    description: Service health monitoring

paths:
  /investments:
    post:
      tags: [Investments]
      summary: Create new investment
      description: Create an investment request linking investor, fund request, and amount invested.
      operationId: createInvestment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InvestmentCreateRequest'
            example:
              amount: 5000
              investorId: "507f1f77bcf86cd799439011"
              requestId: "64d123e5ac45f6789a902312"
      responses:
        '201':
          description: Investment created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvestmentResponse'
              example:
                success: true
                message: "Investment created successfully"
                data:
                  id: "650a1f44bcf86cd799439011"
                  amount: 5000
                  investorId: "507f1f77bcf86cd799439011"
                  requestId: "64d123e5ac45f6789a902312"
                  status: "PENDING"
                  createdAt: "2023-10-15T10:30:00Z"
        '400':
          description: Invalid investment data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Investor or request not found"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      tags: [Investments]
      summary: Get all investments
      description: Retrieve list of all investments for a specific investor.
      operationId: getInvestments
      parameters:
        - name: investorId
          in: query
          required: false
          description: Filter investments by investor ID
          schema:
            type: string
            example: "507f1f77bcf86cd799439011"
      responses:
        '200':
          description: Investments retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvestmentListResponse'
              example:
                success: true
                message: "Investments retrieved successfully"
                data:
                  - id: "650a1f44bcf86cd799439011"
                    amount: 5000
                    requestId: "64d123e5ac45f6789a902312"
                    status: "PENDING"
                  - id: "650a1f45bcf86cd799439012"
                    amount: 8000
                    requestId: "64d123e5ac45f6789a902313"
                    status: "SETTLED"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /investments/{id}:
    get:
      tags: [Investments]
      summary: Get investment by ID
      description: Retrieve details of a specific investment and its settlement status.
      operationId: getInvestmentById
      parameters:
        - name: id
          in: path
          required: true
          description: Investment ID
          schema:
            type: string
            example: "650a1f44bcf86cd799439011"
      responses:
        '200':
          description: Investment details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvestmentResponse'
              example:
                success: true
                message: "Investment retrieved successfully"
                data:
                  id: "650a1f44bcf86cd799439011"
                  amount: 5000
                  investorId: "507f1f77bcf86cd799439011"
                  requestId: "64d123e5ac45f6789a902312"
                  status: "SETTLED"
                  settledProfit: 750
        '404':
          description: Investment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundResponse'
              example:
                success: false
                message: "Investment not found"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /investments/settle:
    put:
      tags: [Investments]
      summary: Settle investment
      description: Distribute profit and update investment status after settlement.
      operationId: settleInvestment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InvestmentSettleRequest'
            example:
              requestId: "64d123e5ac45f6789a902312"
              actualProfit: 750
      responses:
        '200':
          description: Investment settled successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvestmentSettleResponse'
              example:
                success: true
                message: "Investment settled successfully"
                data:
                  distributedShares:
                    - investorId: "507f1f77bcf86cd799439011"
                      share: 500
                    - investorId: "507f1f77bcf86cd799439012"
                      share: 250
        '400':
          description: Invalid settlement data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "Investment not found for given requestId"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /health:
    get:
      tags: [Health]
      summary: Health check
      description: Verify if the Investment Service is operational
      operationId: healthCheck
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              example:
                success: true
                message: "Service is healthy"
                data:
                  status: "UP"
                  service: "investment-service"
                  timestamp: 1673780400000

components:
  schemas:
    # Request Schemas
    InvestmentCreateRequest:
      type: object
      required: [amount, investorId, requestId]
      properties:
        amount:
          type: number
          format: decimal
          minimum: 1
          description: Amount invested by the investor
          example: 5000
        investorId:
          type: string
          description: ID of the investor (User)
          example: "507f1f77bcf86cd799439011"
        requestId:
          type: string
          description: ID of the fund request being invested into
          example: "64d123e5ac45f6789a902312"

    InvestmentSettleRequest:
      type: object
      required: [requestId, actualProfit]
      properties:
        requestId:
          type: string
          description: ID of the funding request being settled
          example: "64d123e5ac45f6789a902312"
        actualProfit:
          type: number
          format: decimal
          minimum: 0
          description: Actual profit earned for distribution
          example: 750

    # Response Data Schemas
    Investment:
      type: object
      properties:
        id:
          type: string
          description: Unique investment ID
          example: "650a1f44bcf86cd799439011"
        amount:
          type: number
          format: decimal
          example: 5000
        investorId:
          type: string
          example: "507f1f77bcf86cd799439011"
        requestId:
          type: string
          example: "64d123e5ac45f6789a902312"
        status:
          type: string
          enum: [PENDING, SETTLED]
          example: "PENDING"
        settledProfit:
          type: number
          format: decimal
          example: 750
        createdAt:
          type: string
          format: date-time
          example: "2023-10-15T10:30:00Z"

    DistributedShare:
      type: object
      properties:
        investorId:
          type: string
          description: Investor who receives share of profit
          example: "507f1f77bcf86cd799439011"
        share:
          type: number
          format: decimal
          example: 500

    HealthData:
      type: object
      properties:
        status:
          type: string
          example: "UP"
        service:
          type: string
          example: "investment-service"
        timestamp:
          type: number
          example: 1673780400000

    # Response Wrappers
    InvestmentResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          $ref: '#/components/schemas/Investment'

    InvestmentListResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: array
          items:
            $ref: '#/components/schemas/Investment'

    InvestmentSettleResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            distributedShares:
              type: array
              items:
                $ref: '#/components/schemas/DistributedShare'

    HealthResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          $ref: '#/components/schemas/HealthData'

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: "An error occurred"

    NotFoundResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: "Resource not found"
